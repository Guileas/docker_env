version: '3'
services:

  #Container to execute your command composer, etc.
  app:
    build:
      args:
        user: mee
        uid: 1000
      context: .
      dockerfile: Dockerfile
    image: laravel
    container_name: laravel-devEnv-container
    hostname: laravel.devEnv.local
    domainname: devEnv.local
    restart: unless-stopped
    working_dir: /app
    volumes:
      - ${WWW_ROOT_FOLDER}:/app
    networks:
      devEnvLocal:
        aliases:
          - devEnv.local

  #Nginx Service
  nginx:
    image: nginx:alpine
    container_name: devEnv-nginx
    hostname: nginx.devEnv.local
    domainname: devEnv.local
    restart: unless-stopped
    ports:
      - "8000:80"
      - "443:443"
    volumes:
      - "${WWW_PUBLIC_FOLDER}:/app/public"
      - "${NGINX_CONF_FOLDER}:/etc/nginx/conf.d"
    networks:
       devEnvLocal:
        aliases:
          - nginx.devEnv.local
      

  #Mariadb Service
  mariadb:
    image: mariadb:10.4
    container_name: mariadb
    dns_search: devEnv.local
    hostname: mariadb.devEnv.local
    domainname: devEnv.local
    restart: on-failure:2
    # Check if Db is switch on
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-upublic", "-ppublic"]
      interval: 120s
      timeout: 1s
      retries: 3
    networks:
      devEnvLocal:
        aliases:
          - mariadb.devEnv.local
          - mariadb104.devEnv.local
    volumes:
      - "${DB_DATA_FOLDER}:/var/lib/mysql"
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=public
      - MYSQL_USER=public
      - MYSQL_PASSWORD=public
    ports:
      - "3306:3306"

networks:
  devEnvLocal:
    driver: bridge
